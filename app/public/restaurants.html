<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Restaurants List</title>

  <!-- Latest compiled and minified CSS & JS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7"
    crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="./assets/css/style.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS"
    crossorigin="anonymous"></script>


</head>

<body>

  <div class="container">
    <div class="se-pre-con"></div>
    <div class="jumbotron">
      <h1 class="text-center">
        <span class="glyphicon glyphicon-fire"></span>Eat Street List</h1>
      <hr>
      <br>

      <div class="text-center">
        <a href="/">
          <button type="button" class="btn btn-lg btn-default">
            <span class="glyphicon glyphicon-home"></span>
          </button>
        </a>
      </div>
    </div>

    <div class="row">
      <div class="col-lg-12">

        <!-- Current Tables in Use -->
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">Restaurant List - zip code <span id="zipcode"></span></h4>
          </div>
          <div class="panel-body" id="tableSection">
          </div>
        </div>

        <footer class="footer">
          <div class="container">
            <p>Control Panel</p>
            <p>
              <a href="#" id="clear">Clear Table</a> |
              <a href="/api/tables">API Restaurant List Link</a> |
              <a href="https://github.com/AlCurry">GitHub Repo</a>
            </p>
          </div>
        </footer>

      </div>

</body>

<script type="text/javascript">
$( document ).ready(function() {

// display spinner with five second fade out to distract from the time it takes to get gps coordinates in the browser, preventing the need to enter zipcode
$(".se-pre-con").fadeOut(5000);

  var lat = 0;
  var long = 0;
  function getLocation() {
    //if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition);
    // } else {
    //x.innerHTML = "Geolocation is not supported by this browser.";
    //    }
    console.log("back here now");
  }
  function showPosition(position) {
    lat = position.coords.latitude;
    long = position.coords.longitude;
    console.log("SP lat: " + lat);
    console.log("SP long: " + long);
    //alert(" Latitude: " + position.coords.latitude +
     // " Longitude: " + position.coords.longitude);

      var currentURL = window.location.origin;

    $.get('/api/restlist/' + lat + "/" + long, function (restaurantData) {

      //console.log("------------------------------------");
     // console.log("URL: " + currentURL + "/api/restlist");
      //console.log("------------------------------------");
      zip = restaurantData.shift();
      console.log(zip);
      console.log(restaurantData);
      //console.log("------------------------------------");

      $("#zipcode").text(zip); 

      // Loop through and display each of the customers
      for (var i = 0; i < restaurantData.length; i++) {

        // Create the HTML Well (Section) and Add the table content for each reserved table
        var tableSection = $("<div>");
        tableSection.addClass("well");
        tableSection.attr("id", "tableWell-" + i + 1);
        $("#tableSection").append(tableSection);

        var tableNumber = i + 1;

        // Then display the remaining fields in the HTML (Section Name, Date, URL)
        $("#tableWell-" + i + 1).append("<h2><span class='label label-primary'>" + tableNumber + "</span> | " + restaurantData[i].restName + "</h2><p>" + restaurantData[i].restAddress + "</p><a href=" + restaurantData[i].restUrl + " target='_blank'>place an order</a>");
        //<a href="/api/tables">API Table Link</a>
      }
    });
  }

  function restaurantQuery() {

    getLocation();

    console.log("lat: " + lat);
    console.log("long: " + long);

    // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
    //$.ajax({ url: currentURL + "/api/tables", method: "GET" })
    // .done(function (restaurantData) {
  }
  function clearTable() {

    var currentURL = window.location.origin;
    $.ajax({ url: currentURL + "/api/clear", method: "POST" });
  }

  $("#clear").on("click", function () {
    alert("Clearing...");
    clearTable();

    // Refresh the page after data is cleared
    location.reload();

  });

  restaurantQuery();
});
</script>

</html>